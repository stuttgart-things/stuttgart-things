---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: apps
  namespace: flux-system
spec:
  interval: 10m0s
  retryInterval: 1m
  dependsOn:
    - name: infra-controllers
  sourceRef:
    kind: GitRepository
    name: flux-system
  path: ./apps/argocd
  prune: true
  wait: true
  timeout: 5m0s
  postBuild:
    substitute:
      IMAGE_REPOSITORY: eu.gcr.io/stuttgart-things/sthings-argocd
      IMAGE_TAG: v2.7.1
      SERVICE_TYPE: LoadBalancer
  # patches:
  #   - patch: |
  #       - op: add
  #         path: /data/hello
  #         value: sthings
  #     target:
  #       kind: ConfigMap
  #       name: argocd-cm
  #       namespace: argocd

    # substituteFrom:
    #   - kind: Secret
    #     name: vault