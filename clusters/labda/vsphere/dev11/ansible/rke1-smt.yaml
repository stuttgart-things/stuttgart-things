apiVersion: tekton.dev/v1
kind: PipelineRun
metadata:
  name: execute-ansible-playbook-smt-rke1
  namespace: ansible
spec:
  pipelineRef:
    name: execute-ansible-playbook
  workspaces:
    - name: shared-workspace
      persistentVolumeClaim:
        claimName: ansible-tekton
    - name: sshCredentials
      secret:
        secretName: github-ssh
  params:
    - name: ansibleWorkingImage
      value: "eu.gcr.io/stuttgart-things/sthings-ansible:8.2.0-3"
    - name: gitRepoUrl
      value: "git@github.com:stuttgart-things/stuttgart-things.git"
    - name: gitRevision
      value: "main"
    - name: gitWorkspaceSubdirectory
      value: "/ansible/base-os"
    - name: installRolesCollections
      value: "false"
    - name: ansiblePlaybooks
      value:
        - "ansible/playbooks/prepare-env.yaml"
        - "ansible/playbooks/base-os.yaml"
    - name: ansibleVarsFile
      value:
        - "targets+-smt-rke1.labul.sva.de;smt-rke1-2.labul.sva.de;smt-rke1-3.labul.sva.de"
        - "manage_filesystem+-true"
        - "update_packages+-true"
        - "install_requirements+-true"
        - "install_motd+-true"
        - "username+-sthings"
        - "lvm_home_sizing+-'15%'"
        - "lvm_root_sizing+-'35%'"
        - "lvm_var_sizing+-'50%'"
        - "send_to_msteams+-true"
        - "reboot_all+-true"