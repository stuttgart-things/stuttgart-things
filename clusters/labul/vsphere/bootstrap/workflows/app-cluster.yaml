---
# STAGE 0 - CREATE VMS
apiVersion: machineshop.sthings.tiab.ssc.sva.de/v1beta1
kind: Terraform
metadata:
 name: sthings-app1
 namespace: terraform
 labels:
   app.kubernetes.io/created-by: machine-shop-operator
   app.kubernetes.io/name: terraform
   app.kubernetes.io/part-of: machine-shop-operator
spec:
 state: present
 variables:
  - vsphere_vm_name="sthings-app1"
  - vm_count=4
  - vm_num_cpus=12
  - vm_memory=12288
  - vm_disk_size=128
  - vsphere_vm_template="/LabUL/host/Cluster01/10.31.101.40/ubuntu23"
  - vsphere_vm_folder_path="phermann/rancher-things"
  - vsphere_network="/LabUL/host/Cluster01/10.31.101.41/LAB-10.31.103"
  - vsphere_datastore="/LabUL/host/Cluster01/10.31.101.41/UL-ESX-SAS-01"
  - vsphere_resource_pool="/LabUL/host/Cluster01/Resources"
  - vsphere_datacenter="LabUL"
 backend:
  - access_key=apps/data/artifacts:accessKey
  - secret_key=apps/data/artifacts:secretKey
 module:
  - moduleName=sthings-app1
  - backendKey=sthings-app1.tfstate
  - moduleSourceUrl=https://artifacts.tiab.labda.sva.de/modules/vsphere-vm.zip
  - backendEndpoint=https://artifacts.app.4sthings.tiab.ssc.sva.de
  - backendRegion=main
  - backendBucket=vsphere-labul
  - tfProviderName=vsphere
  - tfProviderSource=hashicorp/vsphere
  - tfProviderVersion=2.6.1
  - tfVersion=1.6.6
 secrets:
  - vsphere_user=cloud/data/vsphere:username
  - vsphere_password=cloud/data/vsphere:password
  - vsphere_server=cloud/data/vsphere:ip
  - vm_ssh_user=cloud/data/vsphere:vm_ssh_user
  - vm_ssh_password=cloud/data/vsphere:vm_ssh_password
 template: vsphere-vm
 terraform-version: 1.6.6