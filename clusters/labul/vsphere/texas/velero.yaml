---
apiVersion: source.toolkit.fluxcd.io/v1
kind: GitRepository
metadata:
  name: kubernetes-csi-5
  namespace: kube-system
spec:
  interval: 1m0s
  ref:
    tag: v5.0.0
  url: https://github.com/kubernetes-csi/external-snapshotter.git
---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: external-snapshotter-crds
  namespace: kube-system
spec:
  interval: 1h
  retryInterval: 2m
  timeout: 10m
  prune: true
  wait: true
  sourceRef:
    kind: GitRepository
    name: kubernetes-csi-5
  path: ./client/config/crd/
---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: external-snapshotter-controller
  namespace: kube-system
spec:
  interval: 1h
  retryInterval: 2m
  timeout: 10m
  prune: true
  wait: true
  sourceRef:
    kind: GitRepository
    name: kubernetes-csi-5
  path: ./deploy/kubernetes/snapshot-controller
# apiVersion: kustomize.toolkit.fluxcd.io/v1
# kind: Kustomization
# metadata:
#   name: csi-snapshot-controller
#   namespace: flux-system
# spec:
#   interval: 1h
#   retryInterval: 1m
#   timeout: 5m
#   sourceRef:
#     kind: GitRepository
#     name: flux-system
#   path: ./infra/snapshot-controller
#   prune: true
#   wait: true
#   postBuild:
#     substitute:
#       SNAPSHOT_CONTROLLER_NAMESPACE: csi-snapshot-controller
#   patches:
#     - patch: |-
#         - op: replace
#           path: /spec/chart/spec/version
#           value: 2.2.0
#       target:
#         kind: HelmRelease
#         name: snapshot-controller
#         namespace: csi-snapshot-controller
---
kind: VolumeSnapshotClass
apiVersion: snapshot.storage.k8s.io/v1
metadata:
  name: longhorn-snapshot-vsc
  labels:
    velero.io/csi-volumesnapshot-class: "true"
driver: driver.longhorn.io
deletionPolicy: Delete
parameters:
  type: bak