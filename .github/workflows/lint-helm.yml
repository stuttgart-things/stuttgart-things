name: Validate helm chart
on:
 push:
   branches: [ main ]

jobs:
  init-stage:
    name: "init"
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash
    steps:
      - name: substitute branch name
        run: |
          # get branch name
          if [ -z "$SOURCE_BRANCH" ]
          then
            export BRANCH_TMP=${GITHUB_REF##*/}
          else
            export BRANCH_TMP=${SOURCE_BRANCH##*/}
          fi
          # export lowercase
          export BRANCH_LOWER=${BRANCH_TMP,,}
          echo branch_name=${BRANCH_LOWER} >> $GITHUB_ENV
          echo branch_name_limited=${BRANCH_LOWER:0:30} >> $GITHUB_ENV
        id: branch_name
        env:
          SOURCE_BRANCH: ${{ github.head_ref }}

  linting-staging:
    if: github.event.ref == 'refs/heads/main'
    name: Staging
    needs:
      - init-stage
    uses: ./.github/workflows/workflow.yml
    with:
      environment-name: dev
    secrets: inherit
