name: Trigger Terraform Execution
on:
  pull_request:
    types:
      - opened
      - reopened

jobs:
  Get-Terraform-Config:
    if: contains(github.event.pull_request.labels.*.name, 'terraform')
    environment: k8s
    container:
      image: eu.gcr.io/stuttgart-things/machineshop:v1.7.2-2
    runs-on: ghr-stuttgart-things-sthings-cicd
    steps:
      - name: Set Execution Details
        id: set
        run: |
            SPLIT=$(echo ${{ github.event.pull_request.head.ref }} | cut -d'/' -f3)
            TF_WORKING_DIR=$(echo ${{ github.event.pull_request.head.ref }} | cut -d'/' -f1)/$(echo ${{ github.event.pull_request.head.ref }} | cut -d'/' -f2)
            echo ${SPLIT}
            echo ${TF_WORKING_DIR}