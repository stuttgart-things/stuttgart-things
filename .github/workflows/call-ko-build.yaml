---
name: Golang Ko Image-Build
on:
  workflow_call:
    inputs:
      runs-on:
        required: true
        type: string
      environment-name:
        default: k8s
        required: false
        type: string
      registry:
        required: false
        default: ghcr.io
        type: string
      ko-image:
        required: false
        type: string
        default: ghcr.io/ko-build/ko:b256278cc0edcf32bf33904f067eba2d99204d2b

jobs:
  ko-build:
    runs-on: ${{ inputs.runs-on }}
    environment: ${{ inputs.environment-name }}
    env:
      IMAGE_TAG: ${{ inputs.tag }}
    container:
      image: ${{ inputs.ko-image }}
    steps:
      - name: Checkout code/branch
        id: checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: '0'

      - name: Build and push image w/ ko
        run: |
          ko version