---
name: Execute Ansible
on:
  workflow_call:
    inputs:
      branch:
        required: true
        type: string
      inventory:
        required: true
        type: string
      playbook:
        required: false
        type: string
      runs-on:
        required: true
        type: string
      environment-name:
        default: k8s
        required: false
        type: string
      working-image:
        type: string
        default: eu.gcr.io/stuttgart-things/sthings-ansible:9.4.0
        required: false

jobs:
  execute-ansible:
    runs-on: ${{ inputs.runs-on }}
    environment: ${{ inputs.environment-name }}
    container:
      image: ${{ inputs.working-image }}
    env:
      SSH_KEY: ${{ secrets.SSH_KEY }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4.1.1
        with:
          fetch-depth: '0'
          ref: ${{ inputs.branch }}

      - name: Check Ansible Version
        run: |
          ansible --version
        shell: bash