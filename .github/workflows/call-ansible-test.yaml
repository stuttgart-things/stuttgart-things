---
name: Test ansible collection
on:
  workflow_call:
    inputs:
      runs-on:
        required: true
        type: string
      environment-name:
        required: true
        type: string
      ansible-image:
        default: eu.gcr.io/stuttgart-things/sthings-ansible:10.1.0-1
        type: string
        required: false
      continue-error:
        default: false
        required: false
        type: boolean
      collection-package:
        required: true
        type: string

jobs:
  Ansible-Collection-Test:
    runs-on: ${{ inputs.runs-on }}
    container:
      image: ${{ inputs.ansible-image }}
    # env:
    #   VAULT_ADDR: ${{ secrets.VAULT_ADDR }}
    #   VAULT_AUTH_METHOD: ${{ secrets.VAULT_AUTH_METHOD }}
    #   VAULT_NAMESPACE: ${{ secrets.VAULT_NAMESPACE }}
    #   VAULT_ROLE_ID: ${{ secrets.VAULT_ROLE_ID }}
    #   VAULT_SECRET_ID: ${{ secrets.VAULT_SECRET_ID }}
    #   GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
    environment: ${{ inputs.environment-name }}
    continue-on-error: ${{ inputs.continue-error }}
    steps:
      - name:
        uses: actions/download-artifact@v4.1.8
        with:
          name: ${{ inputs.collection-package }}
          path: |-
            /tmp/ansible

      - name: Checkout code
        run: |
          ls -lta /tmp/