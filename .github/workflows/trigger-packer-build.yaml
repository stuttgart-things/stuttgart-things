name: Build Packer Template
on:
  pull_request:
    types:
      - opened
      - reopened

jobs:
 Get-Packer-Config:
   if: contains(github.event.pull_request.labels.*.name, 'packer')
  #  environment: k8s
   container:
    image: eu.gcr.io/stuttgart-things/machineshop:v1.7.2
    # options: --user=root
   runs-on: ghr-stuttgart-things-sthings-cicd
   env:
    PACKER_LOG_PATH: packer.log
    PACKER_LOG: 1
   steps:
     - name: Get Build Details
       run: |
         echo "${{ github.event.pull_request.head.ref }}" | cut -d "-" -f 1
         echo "${{ github.event.pull_request.head.ref }}" | cut -d "-" -f 2
         echo "${{ github.event.pull_request.head.ref }}" | cut -d "-" -f 3


  # Build-Packer-Template:
    # image: eu.gcr.io/stuttgart-things/sthings-packer:1.10.2-9.4.0-2



    # environment: ${{ github.event.pull_request.head.ref }}


    # - name: Checkout code/branch
    # id: checkout
    # uses: actions/checkout@v4

    #  - name: Check config / app versions
    #    id: check
    #    run: |
    #      ls -lta packer/builds/${{ github.event.pull_request.head.ref }}/
    #      packer --version
    #      ansible --version

    #  - name: Packer build
    #    id: build
    #    run: |
    #      cd packer/builds/${{ github.event.pull_request.head.ref }}/

    #      packer init $(ls *.hcl)

    #      packer build -force \
    #      -var "username=${{ secrets.USERNAME }}" \
    #      -var "password=${{ secrets.PASSWORD }}" \
    #      ubuntu23.pkr.hcl

    #      ls -lta