---
name: Send homerun notification
on:
  workflow_call:
    inputs:
      message-body:
        default: "unset"
        type: string
        required: false
      runs-on:
        type: string
        default: ghr-stuttgart-things-labul-automation
        required: false
      environment-name:
        default: k8s
        type: string
        required: false
      machineshop-image:
        default: ghcr.io/stuttgart-things/machineshop/machineshop-9c3178088556daa12a17db5edcc6b5b7@sha256:0aa1134306ca79c47141f05ede01afb373dcea3aab76175ac897b6b89ce4342c
        type: string
        required: false
      continue-on-error:
        default: true
        type: boolean
        required: false

jobs:
  Send-Homerun-Notification:
    runs-on: ${{ inputs.runs-on }}
    container:
      image: ${{ inputs.machineshop-image }}
    environment: ${{ inputs.environment-name }}
    continue-on-error: ${{ inputs.continue-on-error }}
    steps:
      - name: Set workflow result
        run: |
          printenv
          machineshop version

          echo "MESSAGE: ${{ inputs.message-body }}"

          if [ "${{ inputs.message-body }}" != "unset" ]; then
            WORKFLOW_RESULT="successful"
            WORKFLOW_SEVERITY="SUCCESS"
          else
            WORKFLOW_RESULT="failed"
            WORKFLOW_SEVERITY="ERROR"
          fi


          echo SEVERITY: ${WORKFLOW_SEVERITY}
          echo TAGS: ??
          echo RESULT: ${WORKFLOW_RESULT}


          # SET DEFAULTS
          BODY="REPOSITORY: ${GITHUB_REPOSITORY} WORKFLOW: ${GITHUB_WORKFLOW} ARTIFACT: ? BUILD-PARAMETER: ? w/ RUNNER_NAME: ${RUNNER_NAME} WORKFLOW-IMAGE: ? ENV: ${{ inputs.environment-name }}"
          TITLE="Workflow ${GITHUB_WORKFLOW} ?"
          SYSTEM="github-actions"

          echo TITLE: ${TITLE}
          echo BODY: ${BODY}
          echo SYSTEM: ${SYSTEM}
          echo AUTHOR: ${GITHUB_ACTOR}
