---
- hosts: "{{ target_host | default('localhost') }}"
  vars:
    cluster_template: cluster
    state: present
    #path_to_kubeconfig:
  tasks:
    - name: Create cluster on rancher
      kubernetes.core.k8s:
        kubeconfig: "{{ path_to_kubeconfig }}"
        state: "{{ state | default('present') }}"
        definition: "{{ lookup('template', '{{ cluster_template }}.yaml.j2') | from_yaml }}"
      when: state == "present"

- hosts: "{{ target_host | default('all') }}"
  vars_files:
    - "{{ cluster_defaults | ('downstream-defaults.yaml') }}"
    - "{{ cluster_config | default(omit) }}"
