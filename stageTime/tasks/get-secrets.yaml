---
kind: Task
apiVersion: tekton.dev/v1 # or tekton.dev/v1beta1
metadata:
  name: get-secrets
  annotations:
    description: |
      A simple task that writes array
spec:
  params:
    - name: SECRET_PATHS
      description: vault secret paths
      type: array
      default: []
  results:
    - name: secrets
      type: array
      description: secret array results
  steps:
    - name: write-array
      image: eu.gcr.io/stuttgart-things/machineshop:0.1.46
      args:
        - $(params.SECRET_PATHS[*])
      script: |
        #!/usr/bin/env sh

        ALL_SECRETS=""
        for SECRET_PATH in "$@"
        do
          SECRET=$(machineShop get --path ${SECRET_PATH} | tail -n +9 | base64)
          ALL_SECRETS="${combined}${combined:+, }$SECRET"
        done

        echo $ALL_SECRETS

        echo -n "[$ALL_SECRETS]" | tee $(results.secrets.path)
