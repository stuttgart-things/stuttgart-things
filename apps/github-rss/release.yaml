---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: arc-runner-scale-set-${REPOSIORY_NAME}
  namespace: arc-runners
spec:
  interval: 30m
  chart:
    spec:
      chart: gha-runner-scale-set
      version: 0.8.0
      sourceRef:
        kind: HelmRepository
        name: actions-runner-controller-charts
        namespace: arc-systems
      interval: 12h
  values:
    githubConfigUrl: ${GITHUB_URL}
    githubConfigSecret:
      github_token: ${GITHUB_TOKEN}
    containerMode:
      type: kubernetes
      kubernetesModeWorkVolumeClaim:
        accessModes: ["ReadWriteOnce"]
        storageClassName: ${STORAGE_CLASS}
        resources:
          requests:
            storage: ${STORAGE_REQUEST:-100Mi}
    template:
      spec:
        containers:
        - name: runner
          image: ghcr.io/actions/actions-runner:${RUNNER_VERSION:-2.311.0}
          command: ["/home/runner/run.sh"]
          env:
            - name: ACTIONS_RUNNER_REQUIRE_JOB_CONTAINER
              value: "false"
#https://github.com/actions/runner/pkgs/container/actions-runner
