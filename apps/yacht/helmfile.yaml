---
environments:
  default:
    values:
      - environments/default.yaml
  labda:
    values:
      - environments/labda-vsphere.yaml

repositories:
- name: redis
  url: https://charts.bitnami.com/bitnami
- name: stuttgart-things
  url: eu.gcr.io/stuttgart-things
  oci: true

releases:
- name: yacht-redis
  namespace: yacht # should be changed
  chart: redis/redis
  installed: true
  values:
    - master:
        persistence:
          enabled: false
          medium: ""
      replica:
        replicaCount: 2
        persistence:
          enabled: false
          medium: ""
      auth:
        password: {{ .Values.redisPassword }}

- name: yacht-tekton-base
  namespace: tekton-pipelines
  chart: stuttgart-things/yacht-tekton-base
  version: v0.47.0-2
  installed: false

- name: yacht-tekton-resources
  namespace: yacht-tekton
  chart: stuttgart-things/yacht-tekton-resources
  version: v0.47.0-2
  installed: false
  needs:
    - tekton-pipelines/yacht-tekton-base

- name: yacht-application-server
  namespace: yacht
  chart: stuttgart-things/yacht-application-server
  version: 0.3.7
  installed: true
  values:
    - configmaps:
        yas-configuration:
          PIPELINE_WORKSPACE: yacht-tekton
      ingress:
        yacht-application-server:
          hostname: {{ .Values.hostname }}
          clusterName: {{ .Values.clusterName }}
          domain: {{ .Values.domain }}
          tls:
            host: {{ .Values.hostname }}.{{ .Values.clusterName }}.{{ .Values.domain }}
      customresources:
        yas-ingress-certificate:
          spec:
            commonName: {{ .Values.hostname }}.{{ .Values.clusterName }}.{{ .Values.domain }}
            dnsNames:
            - {{ .Values.hostname }}.{{ .Values.clusterName }}.{{ .Values.domain }}
            issuerRef:
              name: {{ .Values.clusterIssuer }}
      secrets:
        redis-connection:
          name: redis-connection
          labels:
            app: yacht-application-server
          dataType: StringData
          secretKVs:
            REDIS_SERVER: yacht-redis-headless
            REDIS_PORT: 6379
            REDIS_PASSWORD: {{ .Values.redisPassword }}
            REDIS_QUEUE: redisqueue:yacht-revisionruns
  # needs:
  #   - yacht/redis
