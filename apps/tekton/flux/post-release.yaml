---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: tekton-resources
  namespace: tekton-cd
spec:
  interval: 30m
  chart:
    spec:
      chart: yacht-tekton-resources
      version: v0.47.10
      sourceRef:
        kind: HelmRepository
        name: stuttgart-things
        namespace: tekton-pipelines
      interval: 12h
  dependsOn:
    - name: tekton-pipelines
      namespace: tekton-pipelines
  values:
    # PARAMETERS
    enableWorkspaces: true
    enableRegistryCredentials: true
    enableGitSecretsSSH: true
    enableSecrets: false
    enablePipelines: false
    enableTasks: false
    enableRuns: false
    defaultNamespace: ${TKN_NAMESPACE}
    # WORKSPACES
    workspaces:
      kaniko-workspace:
        namespace: ${TKN_NAMESPACE}
        volumeMode: Filesystem
        storageClassName: ${TKN_STORAGE_CLASS}
        storage: ${TKN_KANIKO_STORAGE}
        accessModes:
          - ReadWriteOnce
      helm-workspace:
        namespace: ${TKN_NAMESPACE}
        volumeMode: Filesystem
        storageClassName: ${TKN_STORAGE_CLASS}
        storage: ${TKN_HELM_STORAGE}
        accessModes:
          - ReadWriteOnce
    # REGISTRY CREDENTIALS
    registryCredentials:
      scr-${TKN_ENV}:
        namespace: ${TKN_NAMESPACE}
        labels:
          app: tekton
        registry: ${TKN_SCR_URL}
        username: ${TKN_SCR_USER}
        password: ${TKN_SCR_PASSWORD}
    # SSH CREDENTIALS
    gitSecretsSSH:
      codehub:
        name: codehub-ssh
        namespace: ${TKN_NAMESPACE}
        labels:
          app: tekton
        dataType: data
        secretKVs:
          id_rsa: ${TKN_SSH_CODEHUB}
      github:
        name: github-ssh
        namespace: ${TKN_NAMESPACE}
        labels:
          app: tekton
        dataType: data
        secretKVs:
          id_rsa: ${TKN_SSH_GITHUB}
